name: Test Issue Creation

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  test-issue:
    name: Issueä½œæˆãƒ†ã‚¹ãƒˆ
    runs-on: ubuntu-latest

    permissions:
      contents: read
      issues: write

    steps:
      - name: ğŸ“¥ ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ğŸ› ãƒ†ã‚¹ãƒˆIssueä½œæˆ
        uses: actions/github-script@v7
        with:
          script: |
            console.log('Issueä½œæˆã‚’é–‹å§‹ã—ã¾ã™...');

            const issueBody = `
            ## ğŸš¨ è‡ªå‹•ä¿®å¾©ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ

            **æ¤œå‡ºæ—¥æ™‚**: ${new Date().toISOString()}
            **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ**: [#${{ github.run_id }}](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})

            ---

            ## ğŸ“Š ãƒ†ã‚¹ãƒˆçµ±è¨ˆ

            - ç·ã‚¨ãƒ©ãƒ¼æ•°: 1519å€‹
            - ä¿®å¾©æ¸ˆã¿: 198å€‹
            - **æœªä¿®å¾©**: 331å€‹

            ---

            ## âœ… ã“ã®IssueãŒä½œæˆã•ã‚ŒãŸã¨ã„ã†ã“ã¨ã¯

            GitHub Actions Issueä½œæˆæ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ï¼

            ---

            ğŸ¤– Test issue created by GitHub Actions
            `;

            try {
              const result = await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: 'ğŸ§ª [TEST] è‡ªå‹•ä¿®å¾©ã‚·ã‚¹ãƒ†ãƒ  - Issueä½œæˆãƒ†ã‚¹ãƒˆ',
                body: issueBody,
                labels: ['auto-heal', 'test', 'automated']
              });

              console.log(`Issueä½œæˆæˆåŠŸ: #${result.data.number}`);
              console.log(`URL: ${result.data.html_url}`);
            } catch (error) {
              console.error('Issueä½œæˆã‚¨ãƒ©ãƒ¼:', error.message);
              throw error;
            }
