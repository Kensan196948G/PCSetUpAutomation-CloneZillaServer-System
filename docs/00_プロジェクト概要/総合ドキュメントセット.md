# 📘 総合ドキュメントセット

以下の5種類の文書を順番に掲載します：
1. **詳細設計書**
2. **API仕様書**
3. **データベース定義書**
4. **PowerShellスクリプト設計書**
5. **キッティング運用マニュアル**

---

# 1. 🔧 詳細設計書（Clonezilla＋DRBL＋自動PC名設定システム）

## ■ システム構成
- DRBL/Clonezilla Server（Ubuntu）
- 管理GUI（Flask＋SQLite/PostgreSQL）
- APIサーバ（Flask REST）
- Windowsクライアント初期セットアップスクリプト
- ODJプロビジョニング環境（AD）

## ■ モジュール構成
### （1）DRBL管理GUI
- 機能：PC名とSerial、ODJファイル紐付け
- 使用技術：Flask, SQLite, Bootstrap
- 主な画面：
  - 一覧画面
  - CSVインポート画面
  - PC詳細画面
  - ODJアップロード画面

### （2）API
- PC名取得（Serial → PC名）
- ODJファイルパス取得
- 完了ログ登録API

### （3）Windowsセットアップスクリプト
- Serial取得
- API問い合わせ
- PC名設定
- ODJ適用
- Windows Update 実行
- アプリ導入
- 完了ログ送信

## ■ 処理フロー：Windows起動後
1. Serial取得
2. APIへSerial送信
3. PC名受信
4. PC名設定
5. ODJファイル取得
6. djoin適用
7. 再起動
8. 後処理（WU / アプリ）
9. 完了ログ送信

---

# 2. 🌐 API仕様書

## ■ Base URL
```
http://drbl-server/api/
```

---

## ● GET /pcinfo
**概要**：Serial番号からPC名・ODJ情報を返却
```
GET /pcinfo?serial=ABC123456
```
**レスポンス例**：
```json
{
  "pcname": "20251116M",
  "odj_path": "/odj/20251116M.txt"
}
```

---

## ● POST /log
**概要**：Windows側の初期セットアップ完了ログを保存
```
POST /log
{
  "serial": "ABC123456",
  "pcname": "20251116M",
  "status": "completed",
  "timestamp": "2025-11-16 12:33:22"
}
```
**レスポンス例**：
```json
{"result":"ok"}
```

---

# 3. 🗂 データベース定義書

## ■ テーブル：pc_master
| カラム名 | 型 | 説明 |
|----------|------|------|
| id | INTEGER PK | 主キー |
| serial | TEXT UNIQUE | PCのシリアル番号 |
| pcname | TEXT | PC名（YYYYMMDDM） |
| odj_path | TEXT | ODJファイルパス |
| created_at | DATETIME | 登録日 |

---

## ■ テーブル：setup_logs
| カラム名 | 型 | 説明 |
|----------|------|------|
| id | INTEGER PK |
| serial | TEXT |
| pcname | TEXT |
| status | TEXT |
| timestamp | DATETIME |
| logs | TEXT | 任意のログ文字列 |

---

# 4. ⚙ PowerShell スクリプト設計書

## ■ 処理概要
Windows 初期起動後に実行され、以下を自動化する。
1. Serial番号取得
2. DRBL APIへ問い合わせ
3. PC名設定
4. ODJ適用
5. 再起動
6. 後処理実行（Windows Update / アプリ）
7. 完了ログ送信

---

## ■ 関数構成
### ● Get-SerialNumber
```
(Get-CimInstance Win32_BIOS).SerialNumber
```

### ● Get-PCInfoFromAPI
- API `/pcinfo` へアクセス

### ● Set-PCName
```
Rename-Computer -NewName $pcname -Force
```

### ● Apply-ODJ
```
djoin /requestODJ /loadfile "C:\ODJ\$pcname.txt" /localos
```

### ● Run-WindowsUpdate
- PSWindowsUpdate モジュール使用

### ● Install-Apps
- 会社標準アプリのサイレントインストール

### ● Send-SetupLog
- API `/log` へ POST

---

# 5. 📘 キッティング運用マニュアル

## ■ 1. PC納品時の作業
1. 梱包された状態で箱側面を撮影
2. ChatGPT OCRでSerial抽出
3. 導入日ベースでPC名生成（YYYYMMDDM）
4. CSVを保存しDRBLへ取り込み

## ■ 2. 展開作業
1. LANに接続
2. 電源ON（PXE起動）
3. Clonezillaで自動展開開始
4. 完了したら自動再起動

## ■ 3. Windows起動後
- 自動ログオン → 自動スクリプト実行
- PC名自動設定
- ODJ適用 → 再起動
- Windows Update & アプリ

## ■ 4. 完了確認
- 管理GUIでステータス「completed」を確認
- PCを新入社員へ引き渡し

---

必要であれば：
- 図解版のフロー図
- スクリプト実コード
- DRBL管理GUIの画面モック
- テスト項目書
を追加できます。