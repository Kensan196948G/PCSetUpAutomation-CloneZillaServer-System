# DRBL管理GUI 画面仕様書

## 目次

1. [ダッシュボード（トップページ）](#1-ダッシュボードトップページ)
2. [PC一覧画面](#2-pc一覧画面)
3. [PC追加画面](#3-pc追加画面)
4. [PC編集画面](#4-pc編集画面)
5. [CSV一括登録画面](#5-csv一括登録画面)
6. [ODJファイル管理画面](#6-odjファイル管理画面)
7. [セットアップログ画面](#7-セットアップログ画面)
8. [ログ詳細画面](#8-ログ詳細画面)
9. [設定画面](#9-設定画面)

---

## 1. ダッシュボード（トップページ）

### 基本情報
- **画面タイトル**: ダッシュボード
- **URL**: `/` または `/dashboard`
- **アクセス権限**: 全ユーザー
- **更新間隔**: 自動更新（30秒間隔）

### レイアウト図

```
┌──────────────────────────────────────────────────────────────────────┐
│  DRBL管理システム                                    [ユーザー▼]  │
├──────────────────────────────────────────────────────────────────────┤
│ [ダッシュボード] [PC管理] [ログ] [設定]                              │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐  │
│  │ 総PC登録数  │ │セットアップ │ │  進行中     │ │   失敗      │  │
│  │             │ │   完了      │ │             │ │             │  │
│  │    156台    │ │   142台     │ │    8台      │ │    6台      │  │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ 日別セットアップ件数（過去30日）                             │  │
│  │                                                              │  │
│  │  15┤                                    ██                   │  │
│  │  10┤          ██                ██      ██    ██             │  │
│  │   5┤    ██    ██    ██    ██    ██      ██    ██    ██       │  │
│  │   0└─────┴─────┴─────┴─────┴─────┴──────┴─────┴─────┴────   │  │
│  │     11/1  11/5  11/10 11/15 11/20 11/25 11/30 12/5  12/10    │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ 最新セットアップログ                        [すべて表示 →]  │  │
│  ├────────┬─────────────┬──────────┬──────────────────────────┤  │
│  │ Serial │   PC名      │ ステータス│      タイムスタンプ      │  │
│  ├────────┼─────────────┼──────────┼──────────────────────────┤  │
│  │ABC12345│ 20251117M   │ 完了     │ 2025-11-17 10:25:33      │  │
│  │ABC12346│ 20251117M   │ 進行中   │ 2025-11-17 10:18:12      │  │
│  │ABC12347│ 20251117M   │ 完了     │ 2025-11-17 09:55:41      │  │
│  │ABC12348│ 20251116M   │ 失敗     │ 2025-11-17 09:32:18      │  │
│  │ABC12349│ 20251116M   │ 完了     │ 2025-11-17 09:11:05      │  │
│  └────────┴─────────────┴──────────┴──────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ クイックアクション                                           │  │
│  │  [+ PC追加]  [CSV一括登録]  [ODJファイル管理]  [ログ確認]   │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

### 主要機能

1. **統計情報カード**
   - 総PC登録数: pc_masterテーブルの総件数
   - セットアップ完了数: setup_logsテーブルでstatus='completed'の件数
   - 進行中: status='in_progress'の件数
   - 失敗: status='failed'の件数
   - カードクリックで詳細画面へ遷移

2. **日別セットアップ件数グラフ**
   - 過去30日間のセットアップ完了件数を棒グラフ表示
   - ホバーで詳細件数表示

3. **最新ログ表示**
   - setup_logsテーブルから最新5件を取得
   - ステータスに応じて色分け表示
     - 完了: 緑
     - 進行中: 青
     - 失敗: 赤

4. **クイックアクション**
   - 主要画面への直接リンク

### バリデーションルール
- なし（表示のみ）

### エラーメッセージ例
- データベース接続エラー時: 「データベースに接続できません。管理者に連絡してください。」

---

## 2. PC一覧画面

### 基本情報
- **画面タイトル**: PC一覧
- **URL**: `/pcs`
- **アクセス権限**: 全ユーザー

### レイアウト図

```
┌──────────────────────────────────────────────────────────────────────┐
│  PC一覧                                              [ユーザー▼]      │
├──────────────────────────────────────────────────────────────────────┤
│ [ダッシュボード] [PC管理] [ログ] [設定]                              │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ [+ PC追加] [CSV一括登録]                                     │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ Serial検索: [___________] PC名検索: [___________] [検索]    │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ 全156件中 1-50件を表示                                       │  │
│  ├──────┬─────────┬───────────────────┬────────────┬─────────┤  │
│  │Serial│  PC名↑  │     ODJパス       │  登録日時  │  操作   │  │
│  ├──────┼─────────┼───────────────────┼────────────┼─────────┤  │
│  │ABC001│20251101M│/odj/20251101M.txt │2025-11-01  │[編集][削]│  │
│  │ABC002│20251101M│/odj/20251101M.txt │2025-11-01  │[編集][削]│  │
│  │ABC003│20251102M│/odj/20251102M.txt │2025-11-02  │[編集][削]│  │
│  │ABC004│20251102M│未設定             │2025-11-02  │[編集][削]│  │
│  │ABC005│20251103M│/odj/20251103M.txt │2025-11-03  │[編集][削]│  │
│  │  ...│    ...  │       ...         │    ...     │   ...   │  │
│  │ABC050│20251117M│/odj/20251117M.txt │2025-11-17  │[編集][削]│  │
│  └──────┴─────────┴───────────────────┴────────────┴─────────┘  │
│                                                                      │
│  [<<前へ] [1] [2] [3] [4] [次へ>>]                                   │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

### 主要機能

1. **テーブル表示**
   - pc_masterテーブルの全データを表示
   - 1ページ50件表示
   - カラムヘッダークリックでソート（昇順/降順切り替え）

2. **検索機能**
   - Serial番号での部分一致検索
   - PC名での部分一致検索
   - 複数条件でのAND検索

3. **操作ボタン**
   - 編集: PC編集画面へ遷移
   - 削除: 確認ダイアログ後に削除実行

4. **ページネーション**
   - 50件ごとにページ分割
   - ページ番号直接指定可能

### バリデーションルール
- 削除時: 「本当に削除しますか？ Serial: {serial}, PC名: {pcname}」の確認ダイアログ表示

### エラーメッセージ例
- 削除失敗時: 「PCの削除に失敗しました。セットアップログが存在する可能性があります。」
- データ取得失敗時: 「PCデータの取得に失敗しました。」

---

## 3. PC追加画面

### 基本情報
- **画面タイトル**: PC追加
- **URL**: `/pcs/add`
- **アクセス権限**: 管理者のみ

### レイアウト図

```
┌──────────────────────────────────────────────────────────────────────┐
│  PC追加                                              [ユーザー▼]      │
├──────────────────────────────────────────────────────────────────────┤
│ [ダッシュボード] [PC管理] [ログ] [設定]                              │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │                        PC追加                                 │  │
│  │                                                              │  │
│  │  Serial番号 *                                                │  │
│  │  [_____________________________]                             │  │
│  │  ※ 英数字のみ、最大20文字                                    │  │
│  │                                                              │  │
│  │  PC名 *                                                      │  │
│  │  [_____________________________]                             │  │
│  │  ※ YYYYMMDDM形式（例: 20251117M）                           │  │
│  │                                                              │  │
│  │  ODJファイルパス                                             │  │
│  │  [_____________________________] [参照...]                   │  │
│  │  ※ 任意。後から設定可能                                      │  │
│  │                                                              │  │
│  │                                                              │  │
│  │  [キャンセル]                             [登録]            │  │
│  │                                                              │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

### 主要機能

1. **入力フォーム**
   - Serial番号入力（必須）
   - PC名入力（必須）
   - ODJファイルパス入力（任意）

2. **バリデーション**
   - リアルタイムバリデーション（入力中にエラー表示）
   - 登録ボタン押下時の最終バリデーション

3. **登録処理**
   - pc_masterテーブルへのINSERT
   - 成功時はPC一覧画面へリダイレクト

### バリデーションルール

1. **Serial番号**
   - 必須入力
   - 英数字のみ
   - 最大20文字
   - データベース内で一意（重複チェック）

2. **PC名**
   - 必須入力
   - YYYYMMDDM形式（9文字固定）
   - 年: 2000-2099
   - 月: 01-12
   - 日: 01-31
   - サフィックス: M固定

3. **ODJファイルパス**
   - 任意入力
   - 入力時はファイル存在チェック

### エラーメッセージ例

- Serial番号が空: 「Serial番号を入力してください。」
- Serial番号重複: 「このSerial番号は既に登録されています。」
- Serial番号形式エラー: 「Serial番号は英数字のみで入力してください。」
- PC名が空: 「PC名を入力してください。」
- PC名形式エラー: 「PC名はYYYYMMDDM形式で入力してください。（例: 20251117M）」
- PC名の日付不正: 「PC名の日付が不正です。正しい日付を入力してください。」
- ODJファイル存在しない: 「指定されたODJファイルが見つかりません。」
- 登録失敗: 「PCの登録に失敗しました。入力内容を確認してください。」

---

## 4. PC編集画面

### 基本情報
- **画面タイトル**: PC編集
- **URL**: `/pcs/edit/<serial>`
- **アクセス権限**: 管理者のみ

### レイアウト図

```
┌──────────────────────────────────────────────────────────────────────┐
│  PC編集                                              [ユーザー▼]      │
├──────────────────────────────────────────────────────────────────────┤
│ [ダッシュボード] [PC管理] [ログ] [設定]                              │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │                        PC編集                                 │  │
│  │                                                              │  │
│  │  Serial番号                                                  │  │
│  │  ABC12345                                                    │  │
│  │  ※ 変更不可                                                  │  │
│  │                                                              │  │
│  │  PC名 *                                                      │  │
│  │  [20251117M___________________]                              │  │
│  │  ※ YYYYMMDDM形式（例: 20251117M）                           │  │
│  │                                                              │  │
│  │  ODJファイルパス                                             │  │
│  │  [/odj/20251117M.txt__________] [参照...]                    │  │
│  │  ※ 任意。後から設定可能                                      │  │
│  │                                                              │  │
│  │  登録日時: 2025-11-17 09:30:15                               │  │
│  │                                                              │  │
│  │                                                              │  │
│  │  [キャンセル]                             [更新]            │  │
│  │                                                              │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

### 主要機能

1. **編集フォーム**
   - Serial番号は表示のみ（編集不可）
   - PC名編集（必須）
   - ODJファイルパス編集（任意）
   - 登録日時表示（編集不可）

2. **更新処理**
   - pc_masterテーブルのUPDATE
   - 成功時はPC一覧画面へリダイレクト

### バリデーションルール

1. **PC名**
   - PC追加画面と同じ
   - YYYYMMDDM形式（9文字固定）
   - 日付の妥当性チェック

2. **ODJファイルパス**
   - 任意入力
   - 入力時はファイル存在チェック

### エラーメッセージ例

- PC名が空: 「PC名を入力してください。」
- PC名形式エラー: 「PC名はYYYYMMDDM形式で入力してください。（例: 20251117M）」
- PC名の日付不正: 「PC名の日付が不正です。正しい日付を入力してください。」
- ODJファイル存在しない: 「指定されたODJファイルが見つかりません。」
- 更新失敗: 「PCの更新に失敗しました。入力内容を確認してください。」
- PC未発見: 「指定されたPCが見つかりません。」

---

## 5. CSV一括登録画面

### 基本情報
- **画面タイトル**: CSV一括登録
- **URL**: `/pcs/import`
- **アクセス権限**: 管理者のみ

### レイアウト図

```
┌──────────────────────────────────────────────────────────────────────┐
│  CSV一括登録                                         [ユーザー▼]      │
├──────────────────────────────────────────────────────────────────────┤
│ [ダッシュボード] [PC管理] [ログ] [設定]                              │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ ステップ1: CSVファイルのアップロード                          │  │
│  │                                                              │  │
│  │  [ファイルを選択]  選択されていません                        │  │
│  │                                                              │  │
│  │  [サンプルCSVダウンロード]                                   │  │
│  │                                                              │  │
│  │  CSVフォーマット:                                            │  │
│  │  ┌───────────────────────────────────────────────┐          │  │
│  │  │ serial,pcname,odj_path                       │          │  │
│  │  │ ABC12345,20251117M,/odj/20251117M.txt        │          │  │
│  │  │ ABC12346,20251117M,/odj/20251117M.txt        │          │  │
│  │  │ ABC12347,20251118M,                          │          │  │
│  │  └───────────────────────────────────────────────┘          │  │
│  │                                                              │  │
│  │  ※ ヘッダー行必須                                            │  │
│  │  ※ odj_pathは省略可能                                       │  │
│  │  ※ UTF-8エンコーディング推奨                                │  │
│  │                                                              │  │
│  │                              [アップロード]                  │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ ステップ2: インポートプレビュー                               │  │
│  │                                                              │  │
│  │  総件数: 100件  有効: 95件  エラー: 5件                      │  │
│  │                                                              │  │
│  │  ┌────────┬─────────┬───────────────────┬──────────┐      │  │
│  │  │ Serial │  PC名   │     ODJパス       │ 状態     │      │  │
│  │  ├────────┼─────────┼───────────────────┼──────────┤      │  │
│  │  │ABC12345│20251117M│/odj/20251117M.txt │ OK       │      │  │
│  │  │ABC12346│20251117M│/odj/20251117M.txt │ OK       │      │  │
│  │  │ABC12347│2025118M │                   │ エラー※1 │      │  │
│  │  │ABC12348│         │                   │ エラー※2 │      │  │
│  │  │ABC0001 │20251118M│                   │ 重複※3   │      │  │
│  │  │  ...   │   ...   │       ...         │  ...     │      │  │
│  │  └────────┴─────────┴───────────────────┴──────────┘      │  │
│  │                                                              │  │
│  │  エラー詳細:                                                 │  │
│  │  ※1 行3: PC名の形式が不正です                               │  │
│  │  ※2 行4: Serial番号が空です                                 │  │
│  │  ※3 行5: Serial番号が既に登録されています                   │  │
│  │                                                              │  │
│  │  [キャンセル]      [エラー行を除外してインポート]  [再試行]  │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ ステップ3: インポート結果                                     │  │
│  │                                                              │  │
│  │  ✓ インポート完了                                            │  │
│  │                                                              │  │
│  │  成功: 95件                                                  │  │
│  │  失敗: 5件                                                   │  │
│  │  処理時間: 2.3秒                                             │  │
│  │                                                              │  │
│  │  失敗詳細:                                                   │  │
│  │  - 行3: PC名の形式が不正です                                 │  │
│  │  - 行4: Serial番号が空です                                   │  │
│  │  - 行5: Serial番号が既に登録されています                     │  │
│  │  - 行12: ODJファイルが見つかりません                         │  │
│  │  - 行28: データベースエラー                                  │  │
│  │                                                              │  │
│  │  [エラーログをダウンロード]          [PC一覧へ戻る]         │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

### 主要機能

1. **CSVアップロード**
   - ファイル選択ダイアログ
   - サンプルCSVダウンロード機能
   - CSV解析とバリデーション

2. **プレビュー表示**
   - アップロードされたCSVの内容を表形式で表示
   - 各行のバリデーション結果表示
   - エラー詳細表示

3. **インポート実行**
   - エラー行除外オプション
   - バッチINSERT処理
   - トランザクション管理

4. **結果表示**
   - 成功件数、失敗件数の集計
   - 失敗理由の詳細表示
   - エラーログCSVダウンロード

### バリデーションルール

1. **CSVフォーマット**
   - ヘッダー行必須（serial, pcname, odj_path）
   - UTF-8エンコーディング
   - 最大1000行まで

2. **各行のバリデーション**
   - Serial番号: 必須、英数字のみ、最大20文字、重複チェック
   - PC名: 必須、YYYYMMDDM形式
   - ODJパス: 任意、入力時は存在チェック

### エラーメッセージ例

- ファイル未選択: 「CSVファイルを選択してください。」
- ファイル形式エラー: 「CSVファイルを選択してください。」
- エンコーディングエラー: 「UTF-8エンコーディングのCSVファイルを使用してください。」
- 行数超過: 「CSVファイルは1000行以内にしてください。」
- ヘッダーエラー: 「CSVのヘッダーが不正です。serial,pcname,odj_pathを含めてください。」
- Serial空: 「行{n}: Serial番号が空です。」
- Serial重複: 「行{n}: Serial番号が既に登録されています。」
- PC名形式エラー: 「行{n}: PC名の形式が不正です。YYYYMMDDM形式で入力してください。」
- ODJファイル不存在: 「行{n}: ODJファイルが見つかりません。」

---

## 6. ODJファイル管理画面

### 基本情報
- **画面タイトル**: ODJファイル管理
- **URL**: `/odj`
- **アクセス権限**: 管理者のみ

### レイアウト図

```
┌──────────────────────────────────────────────────────────────────────┐
│  ODJファイル管理                                     [ユーザー▼]      │
├──────────────────────────────────────────────────────────────────────┤
│ [ダッシュボード] [PC管理] [ログ] [設定]                              │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ ODJファイルのアップロード                                     │  │
│  │                                                              │  │
│  │  単一ファイル: [ファイルを選択] [アップロード]               │  │
│  │                                                              │  │
│  │  一括アップロード（ZIP）: [ファイルを選択] [一括アップロード]│  │
│  │  ※ ZIPファイル内の.txtファイルを一括アップロード            │  │
│  │                                                              │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ アップロード済みODJファイル                                   │  │
│  │                                                              │  │
│  │ ファイル名検索: [___________] [検索]  [未紐付けのみ表示☐]   │  │
│  │                                                              │  │
│  │ 全85件                                                       │  │
│  │                                                              │  │
│  │ ┌──────────────┬────────┬────────────┬──────────┬─────────┐│  │
│  │ │ ファイル名   │サイズ  │アップロード│紐付PC名  │  操作   ││  │
│  │ ├──────────────┼────────┼────────────┼──────────┼─────────┤│  │
│  │ │20251117M.txt │ 2.3KB  │2025-11-17  │20251117M │[DL][削] ││  │
│  │ │20251116M.txt │ 2.1KB  │2025-11-16  │20251116M │[DL][削] ││  │
│  │ │20251115M.txt │ 2.4KB  │2025-11-15  │20251115M │[DL][削] ││  │
│  │ │20251114M.txt │ 2.2KB  │2025-11-14  │未紐付け  │[DL][削] ││  │
│  │ │20251113M.txt │ 2.3KB  │2025-11-13  │20251113M │[DL][削] ││  │
│  │ │  ...         │  ...   │    ...     │  ...     │   ...   ││  │
│  │ └──────────────┴────────┴────────────┴──────────┴─────────┘│  │
│  │                                                              │  │
│  │ [<<前へ] [1] [2] [次へ>>]                                     │  │
│  │                                                              │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ PC名とODJファイルの紐付け                                     │  │
│  │                                                              │  │
│  │  PC名: [20251117M___] → ODJファイル: [20251117M.txt▼]       │  │
│  │                                                              │  │
│  │                              [紐付け実行]                    │  │
│  │                                                              │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

### 主要機能

1. **ファイルアップロード**
   - 単一ODJファイルアップロード（.txt形式）
   - ZIP一括アップロード（複数.txtファイルを含むZIP）
   - サーバ保存先: `/srv/odj/` または設定で指定

2. **ファイル一覧**
   - アップロード済みODJファイルのリスト表示
   - ファイル名、サイズ、アップロード日時、紐付PC名を表示
   - 未紐付けファイルのフィルタリング

3. **ファイル操作**
   - ダウンロード（DL）: ファイルダウンロード
   - 削除: 確認後にファイル削除

4. **紐付け機能**
   - PC名とODJファイルの手動紐付け
   - pc_masterテーブルのodj_path更新

### バリデーションルール

1. **単一ファイルアップロード**
   - 拡張子: .txt のみ
   - 最大サイズ: 10MB
   - ファイル名重複チェック

2. **ZIP一括アップロード**
   - 拡張子: .zip のみ
   - 最大サイズ: 50MB
   - ZIP内は.txtファイルのみ
   - 最大100ファイルまで

3. **紐付け**
   - PC名がpc_masterテーブルに存在すること
   - ODJファイルが存在すること

### エラーメッセージ例

- ファイル未選択: 「ファイルを選択してください。」
- 拡張子エラー: 「.txt形式のファイルを選択してください。」
- サイズ超過: 「ファイルサイズは10MB以内にしてください。」
- ファイル名重複: 「同名のファイルが既に存在します。」
- ZIP拡張子エラー: 「.zip形式のファイルを選択してください。」
- ZIP内容エラー: 「ZIP内に.txt以外のファイルが含まれています。」
- ZIPファイル数超過: 「ZIPファイル内のファイル数は100個以内にしてください。」
- 紐付けPC名エラー: 「指定されたPC名が見つかりません。」
- 紐付けODJエラー: 「指定されたODJファイルが見つかりません。」
- 削除失敗: 「ファイルの削除に失敗しました。」

---

## 7. セットアップログ画面

### 基本情報
- **画面タイトル**: セットアップログ
- **URL**: `/logs`
- **アクセス権限**: 全ユーザー
- **更新間隔**: 自動更新（10秒間隔）

### レイアウト図

```
┌──────────────────────────────────────────────────────────────────────┐
│  セットアップログ                                    [ユーザー▼]      │
├──────────────────────────────────────────────────────────────────────┤
│ [ダッシュボード] [PC管理] [ログ] [設定]                              │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ フィルター                                                   │  │
│  │                                                              │  │
│  │ ステータス: [すべて▼] 期間: [2025-11-01] 〜 [2025-11-17]    │  │
│  │                                                              │  │
│  │ Serial検索: [___________] PC名検索: [___________] [検索]    │  │
│  │                                                              │  │
│  │ [CSV出力] [JSON出力]                      自動更新: [ON▼]   │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ 全456件中 1-50件を表示                    最終更新: 10:25:45 │  │
│  ├────────┬─────────┬──────────┬──────────────────┬──────────┤  │
│  │ Serial │  PC名   │ステータス│  タイムスタンプ  │  詳細    │  │
│  ├────────┼─────────┼──────────┼──────────────────┼──────────┤  │
│  │ABC12345│20251117M│ 完了 ✓   │2025-11-17 10:25:33│ [詳細]  │  │
│  │ABC12346│20251117M│ 進行中...│2025-11-17 10:18:12│ [詳細]  │  │
│  │ABC12347│20251117M│ 完了 ✓   │2025-11-17 09:55:41│ [詳細]  │  │
│  │ABC12348│20251116M│ 失敗 ✗   │2025-11-17 09:32:18│ [詳細]  │  │
│  │ABC12349│20251116M│ 完了 ✓   │2025-11-17 09:11:05│ [詳細]  │  │
│  │ABC12350│20251116M│ 進行中...│2025-11-17 08:55:30│ [詳細]  │  │
│  │ABC12351│20251116M│ 完了 ✓   │2025-11-17 08:42:15│ [詳細]  │  │
│  │  ...   │   ...   │   ...    │       ...        │   ...   │  │
│  │ABC12394│20251115M│ 完了 ✓   │2025-11-15 16:20:10│ [詳細]  │  │
│  └────────┴─────────┴──────────┴──────────────────┴──────────┘  │
│                                                                      │
│  [<<前へ] [1] [2] [3] [4] [5] [6] [7] [8] [9] [10] [次へ>>]         │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ ステータス別集計                                             │  │
│  │  完了: 142件 (91.0%)   進行中: 8件 (5.1%)   失敗: 6件 (3.9%) │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

### 主要機能

1. **ログ一覧表示**
   - setup_logsテーブルの全データを表示
   - 1ページ50件
   - タイムスタンプ降順でソート（最新が上）

2. **リアルタイム更新**
   - 10秒間隔で自動更新
   - ON/OFFトグル可能
   - 更新時は最終更新時刻を表示

3. **フィルタリング**
   - ステータス: すべて/完了/進行中/失敗
   - 期間指定: 開始日〜終了日
   - Serial番号検索（部分一致）
   - PC名検索（部分一致）

4. **エクスポート**
   - CSV形式でダウンロード
   - JSON形式でダウンロード
   - フィルター適用後のデータを出力

5. **ステータス表示**
   - 完了: 緑色 ✓
   - 進行中: 青色 ...
   - 失敗: 赤色 ✗

6. **詳細リンク**
   - ログ詳細画面へ遷移（Serial番号をパラメータとして渡す）

### バリデーションルール

- 期間指定: 開始日 ≤ 終了日
- 期間の最大範囲: 90日以内

### エラーメッセージ例

- 期間エラー: 「開始日は終了日より前の日付を指定してください。」
- 期間範囲超過: 「期間は90日以内で指定してください。」
- データ取得失敗: 「ログデータの取得に失敗しました。」
- エクスポート失敗: 「データのエクスポートに失敗しました。」

---

## 8. ログ詳細画面

### 基本情報
- **画面タイトル**: ログ詳細
- **URL**: `/logs/detail/<serial>`
- **アクセス権限**: 全ユーザー
- **更新間隔**: 自動更新（5秒間隔、進行中のみ）

### レイアウト図

```
┌──────────────────────────────────────────────────────────────────────┐
│  ログ詳細 - ABC12345                                 [ユーザー▼]      │
├──────────────────────────────────────────────────────────────────────┤
│ [ダッシュボード] [PC管理] [ログ] [設定]                              │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  [← ログ一覧に戻る]                                                  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ PC情報                                                       │  │
│  │                                                              │  │
│  │  Serial番号: ABC12345                                        │  │
│  │  PC名: 20251117M                                             │  │
│  │  最終ステータス: 完了 ✓                                      │  │
│  │  セットアップ開始: 2025-11-17 09:00:00                       │  │
│  │  セットアップ完了: 2025-11-17 10:25:33                       │  │
│  │  所要時間: 1時間25分33秒                                     │  │
│  │                                                              │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ セットアップ進捗                                             │  │
│  │                                                              │  │
│  │  [完了✓] イメージング                     09:00:00 - 09:35:12│  │
│  │  [完了✓] PC名設定                         09:36:00 - 09:36:15│  │
│  │  [完了✓] ODJ適用                          09:37:00 - 09:38:30│  │
│  │  [完了✓] Windows Update (1回目)           09:40:00 - 10:05:20│  │
│  │  [完了✓] Windows Update (2回目)           10:07:00 - 10:15:45│  │
│  │  [完了✓] アプリケーション導入             10:18:00 - 10:24:50│  │
│  │  [完了✓] 完了ログ送信                     10:25:30 - 10:25:33│  │
│  │                                                              │  │
│  │  ████████████████████████████████████████ 100%               │  │
│  │                                                              │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ 詳細ログ                                                     │  │
│  │                                                              │  │
│  │ ┌────────────────┬───────────────────────────────────────┐  │  │
│  │ │  タイムスタンプ│              ログメッセージ              │  │  │
│  │ ├────────────────┼───────────────────────────────────────┤  │  │
│  │ │ 09:00:00       │ [INFO] セットアップ開始               │  │  │
│  │ │ 09:00:05       │ [INFO] PXEブート完了                  │  │  │
│  │ │ 09:00:10       │ [INFO] Clonezillaイメージング開始     │  │  │
│  │ │ 09:35:12       │ [INFO] イメージング完了               │  │  │
│  │ │ 09:36:00       │ [INFO] Windows初回起動                │  │  │
│  │ │ 09:36:05       │ [INFO] Serial番号取得: ABC12345       │  │  │
│  │ │ 09:36:08       │ [INFO] DRBL API呼び出し成功           │  │  │
│  │ │ 09:36:10       │ [INFO] PC名設定: 20251117M            │  │  │
│  │ │ 09:36:15       │ [INFO] PC名設定完了（再起動）         │  │  │
│  │ │ 09:37:00       │ [INFO] 再起動完了                     │  │  │
│  │ │ 09:37:05       │ [INFO] ODJファイル取得開始            │  │  │
│  │ │ 09:37:10       │ [INFO] ODJファイル取得完了            │  │  │
│  │ │ 09:37:15       │ [INFO] djoin実行開始                  │  │  │
│  │ │ 09:38:30       │ [INFO] ODJ適用完了（再起動）          │  │  │
│  │ │ 09:40:00       │ [INFO] ドメイン参加確認完了           │  │  │
│  │ │ 09:40:05       │ [INFO] Windows Update開始 (1/2)       │  │  │
│  │ │ 10:05:20       │ [INFO] Windows Update完了 (1/2)       │  │  │
│  │ │ 10:07:00       │ [INFO] Windows Update開始 (2/2)       │  │  │
│  │ │ 10:15:45       │ [INFO] Windows Update完了 (2/2)       │  │  │
│  │ │ 10:18:00       │ [INFO] アプリケーション導入開始       │  │  │
│  │ │ 10:18:30       │ [INFO] Microsoft 365 Apps導入開始     │  │  │
│  │ │ 10:22:15       │ [INFO] Microsoft 365 Apps導入完了     │  │  │
│  │ │ 10:22:30       │ [INFO] セキュリティソフト導入開始     │  │  │
│  │ │ 10:24:50       │ [INFO] セキュリティソフト導入完了     │  │  │
│  │ │ 10:25:00       │ [INFO] 全工程完了                     │  │  │
│  │ │ 10:25:30       │ [INFO] 完了ログ送信開始               │  │  │
│  │ │ 10:25:33       │ [INFO] 完了ログ送信完了               │  │  │
│  │ └────────────────┴───────────────────────────────────────┘  │  │
│  │                                                              │  │
│  │ [ログ全文をダウンロード（TXT）]                              │  │
│  │                                                              │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

### 失敗例のレイアウト

```
┌──────────────────────────────────────────────────────────────────────┐
│  ログ詳細 - ABC12348                                 [ユーザー▼]      │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ PC情報                                                       │  │
│  │                                                              │  │
│  │  Serial番号: ABC12348                                        │  │
│  │  PC名: 20251116M                                             │  │
│  │  最終ステータス: 失敗 ✗                                      │  │
│  │  セットアップ開始: 2025-11-17 08:30:00                       │  │
│  │  失敗時刻: 2025-11-17 09:32:18                               │  │
│  │  所要時間: 1時間2分18秒                                      │  │
│  │                                                              │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ セットアップ進捗                                             │  │
│  │                                                              │  │
│  │  [完了✓] イメージング                     08:30:00 - 09:05:12│  │
│  │  [完了✓] PC名設定                         09:06:00 - 09:06:15│  │
│  │  [完了✓] ODJ適用                          09:07:00 - 09:08:30│  │
│  │  [失敗✗] Windows Update (1回目)           09:10:00 - 09:32:18│  │
│  │  [未実施] Windows Update (2回目)                             │  │
│  │  [未実施] アプリケーション導入                               │  │
│  │  [未実施] 完了ログ送信                                       │  │
│  │                                                              │  │
│  │  ███████████████████░░░░░░░░░░░░░░░░░░░░ 43%                │  │
│  │                                                              │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ エラー詳細                                                   │  │
│  │                                                              │  │
│  │  フェーズ: Windows Update (1回目)                            │  │
│  │  エラーコード: 0x80070002                                    │  │
│  │  エラーメッセージ: Windows Updateサービスに接続できません    │  │
│  │                                                              │  │
│  │  推奨対処:                                                   │  │
│  │  1. ネットワーク接続を確認してください                       │  │
│  │  2. Windows Updateサービスの状態を確認してください           │  │
│  │  3. プロキシ設定を確認してください                           │  │
│  │                                                              │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ 詳細ログ（一部抜粋）                                         │  │
│  │                                                              │  │
│  │ ...                                                          │  │
│  │ 09:10:00  [INFO] Windows Update開始 (1/2)                    │  │
│  │ 09:10:05  [INFO] 更新プログラム検索中...                     │  │
│  │ 09:15:30  [WARN] 更新プログラムの検索に時間がかかっています   │  │
│  │ 09:30:45  [ERROR] Windows Updateサービスに接続できません     │  │
│  │ 09:30:50  [ERROR] エラーコード: 0x80070002                   │  │
│  │ 09:31:00  [INFO] リトライ 1/3                                │  │
│  │ 09:31:30  [ERROR] Windows Updateサービスに接続できません     │  │
│  │ 09:32:00  [INFO] リトライ 2/3                                │  │
│  │ 09:32:15  [ERROR] Windows Updateサービスに接続できません     │  │
│  │ 09:32:18  [ERROR] リトライ上限到達。セットアップ失敗         │  │
│  │ 09:32:18  [INFO] エラーログ送信                              │  │
│  │                                                              │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

### 主要機能

1. **PC情報表示**
   - Serial番号、PC名、最終ステータス
   - セットアップ開始/完了時刻、所要時間

2. **フェーズ別進捗表示**
   - 各フェーズの実行状況（完了/進行中/失敗/未実施）
   - 各フェーズの開始/終了時刻
   - プログレスバー

3. **詳細ログ表示**
   - タイムスタンプとログメッセージをテーブル形式で表示
   - ログレベル別の色分け
     - INFO: 黒
     - WARN: オレンジ
     - ERROR: 赤
   - ログ全文ダウンロード（TXT形式）

4. **エラー詳細表示（失敗時のみ）**
   - 失敗フェーズ
   - エラーコード
   - エラーメッセージ
   - 推奨対処方法

5. **リアルタイム更新（進行中のみ）**
   - 5秒間隔で自動更新
   - ステータスが完了/失敗になったら自動更新停止

### バリデーションルール
- なし（表示のみ）

### エラーメッセージ例
- PC未発見: 「指定されたSerial番号のPCが見つかりません。」
- ログ未発見: 「指定されたPCのセットアップログが見つかりません。」
- データ取得失敗: 「ログデータの取得に失敗しました。」

---

## 9. 設定画面

### 基本情報
- **画面タイトル**: 設定
- **URL**: `/settings`
- **アクセス権限**: 管理者のみ

### レイアウト図

```
┌──────────────────────────────────────────────────────────────────────┐
│  設定                                                [ユーザー▼]      │
├──────────────────────────────────────────────────────────────────────┤
│ [ダッシュボード] [PC管理] [ログ] [設定]                              │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ システム設定                                                 │  │
│  │                                                              │  │
│  │  DRBLサーバ設定                                              │  │
│  │  ┌──────────────────────────────────────────────────────┐  │  │
│  │  │ サーバIPアドレス *                                   │  │  │
│  │  │ [192.168.1.100__________]                            │  │  │
│  │  │                                                      │  │  │
│  │  │ APIポート *                                          │  │  │
│  │  │ [5000____]                                           │  │  │
│  │  │                                                      │  │  │
│  │  │ APIトークン                                          │  │  │
│  │  │ [********************__________]                     │  │  │
│  │  │ ※ 未設定の場合は認証なし                             │  │  │
│  │  │                                                      │  │  │
│  │  │ [テスト接続]                                         │  │  │
│  │  └──────────────────────────────────────────────────────┘  │  │
│  │                                                              │  │
│  │  ODJファイル設定                                             │  │
│  │  ┌──────────────────────────────────────────────────────┐  │  │
│  │  │ ODJファイル保存先 *                                  │  │  │
│  │  │ [/srv/odj/___________________] [参照...]             │  │  │
│  │  │                                                      │  │  │
│  │  │ 最大ファイルサイズ (MB) *                            │  │  │
│  │  │ [10_____]                                            │  │  │
│  │  │                                                      │  │  │
│  │  └──────────────────────────────────────────────────────┘  │  │
│  │                                                              │  │
│  │  ログ設定                                                    │  │
│  │  ┌──────────────────────────────────────────────────────┐  │  │
│  │  │ ログレベル *                                         │  │  │
│  │  │ [INFO▼]  (DEBUG / INFO / WARN / ERROR)               │  │  │
│  │  │                                                      │  │  │
│  │  │ ログ保存期間 (日) *                                  │  │  │
│  │  │ [90_____]                                            │  │  │
│  │  │                                                      │  │  │
│  │  │ 自動ログクリーンアップ                               │  │  │
│  │  │ [有効 ☑]                                            │  │  │
│  │  │                                                      │  │  │
│  │  └──────────────────────────────────────────────────────┘  │  │
│  │                                                              │  │
│  │  バックアップ設定                                            │  │
│  │  ┌──────────────────────────────────────────────────────┐  │  │
│  │  │ 自動バックアップ                                     │  │  │
│  │  │ [有効 ☑]                                            │  │  │
│  │  │                                                      │  │  │
│  │  │ バックアップ間隔                                     │  │  │
│  │  │ [毎日▼]  (毎日 / 毎週 / 毎月)                        │  │  │
│  │  │                                                      │  │  │
│  │  │ バックアップ保存先                                   │  │  │
│  │  │ [/backup/drbl_____] [参照...]                        │  │  │
│  │  │                                                      │  │  │
│  │  │ [今すぐバックアップ実行]                             │  │  │
│  │  │                                                      │  │  │
│  │  └──────────────────────────────────────────────────────┘  │  │
│  │                                                              │  │
│  │  通知設定                                                    │  │
│  │  ┌──────────────────────────────────────────────────────┐  │  │
│  │  │ メール通知                                           │  │  │
│  │  │ [有効 ☑]                                            │  │  │
│  │  │                                                      │  │  │
│  │  │ 通知先メールアドレス                                 │  │  │
│  │  │ [admin@example.com_________________________]         │  │  │
│  │  │                                                      │  │  │
│  │  │ 通知トリガー                                         │  │  │
│  │  │ [☑] セットアップ失敗時                              │  │  │
│  │  │ [☑] セットアップ完了時                              │  │  │
│  │  │ [☐] セットアップ開始時                              │  │  │
│  │  │                                                      │  │  │
│  │  │ [テストメール送信]                                   │  │  │
│  │  │                                                      │  │  │
│  │  └──────────────────────────────────────────────────────┘  │  │
│  │                                                              │  │
│  │                                                              │  │
│  │  [デフォルトに戻す]                          [設定を保存]   │  │
│  │                                                              │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

### 主要機能

1. **DRBLサーバ設定**
   - サーバIPアドレス、APIポート、APIトークンの設定
   - テスト接続機能（設定値の疎通確認）

2. **ODJファイル設定**
   - 保存先ディレクトリパスの設定
   - 最大ファイルサイズの設定

3. **ログ設定**
   - ログレベルの設定（DEBUG/INFO/WARN/ERROR）
   - ログ保存期間の設定
   - 自動ログクリーンアップの有効/無効

4. **バックアップ設定**
   - 自動バックアップの有効/無効
   - バックアップ間隔の設定（毎日/毎週/毎月）
   - バックアップ保存先の設定
   - 手動バックアップ実行ボタン

5. **通知設定**
   - メール通知の有効/無効
   - 通知先メールアドレスの設定
   - 通知トリガーの選択（失敗時/完了時/開始時）
   - テストメール送信機能

6. **設定の保存・リセット**
   - 設定を保存ボタン: 全設定をデータベースまたは設定ファイルへ保存
   - デフォルトに戻すボタン: 全設定を初期値に戻す

### バリデーションルール

1. **DRBLサーバ設定**
   - サーバIPアドレス: 必須、IPv4形式（XXX.XXX.XXX.XXX）
   - APIポート: 必須、1-65535の範囲
   - APIトークン: 任意、英数字のみ

2. **ODJファイル設定**
   - 保存先: 必須、ディレクトリ存在チェック
   - 最大ファイルサイズ: 必須、1-100MBの範囲

3. **ログ設定**
   - ログレベル: 必須、選択肢から選択
   - 保存期間: 必須、1-365日の範囲

4. **バックアップ設定**
   - 保存先: バックアップ有効時は必須、ディレクトリ存在チェック

5. **通知設定**
   - メールアドレス: メール通知有効時は必須、メール形式チェック

### エラーメッセージ例

- IPアドレス空: 「サーバIPアドレスを入力してください。」
- IPアドレス形式エラー: 「正しいIPv4形式で入力してください。（例: 192.168.1.100）」
- ポート空: 「APIポートを入力してください。」
- ポート範囲エラー: 「ポート番号は1-65535の範囲で入力してください。」
- テスト接続失敗: 「DRBLサーバへの接続に失敗しました。設定を確認してください。」
- ODJ保存先空: 「ODJファイル保存先を入力してください。」
- ODJ保存先存在しない: 「指定されたディレクトリが見つかりません。」
- ファイルサイズ範囲エラー: 「最大ファイルサイズは1-100MBの範囲で入力してください。」
- ログ保存期間範囲エラー: 「ログ保存期間は1-365日の範囲で入力してください。」
- バックアップ保存先空: 「バックアップが有効な場合、保存先を指定してください。」
- バックアップ保存先存在しない: 「指定されたバックアップ保存先が見つかりません。」
- メールアドレス空: 「メール通知が有効な場合、通知先メールアドレスを入力してください。」
- メールアドレス形式エラー: 「正しいメールアドレス形式で入力してください。」
- テストメール送信失敗: 「テストメールの送信に失敗しました。メール設定を確認してください。」
- 設定保存失敗: 「設定の保存に失敗しました。」
- バックアップ実行失敗: 「バックアップの実行に失敗しました。」

---

## 共通仕様

### ナビゲーションメニュー

全画面共通のグローバルナビゲーション:

```
[ダッシュボード] [PC管理] [ログ] [設定]
```

- **ダッシュボード**: `/` または `/dashboard`
- **PC管理**: ドロップダウン
  - PC一覧: `/pcs`
  - PC追加: `/pcs/add`
  - CSV一括登録: `/pcs/import`
  - ODJファイル管理: `/odj`
- **ログ**: `/logs`
- **設定**: `/settings`

### ユーザーメニュー

全画面右上に配置:

```
[ユーザー名▼]
  - プロフィール
  - パスワード変更
  - ログアウト
```

### レスポンシブデザイン

- デスクトップ: 1280px以上
- タブレット: 768px - 1279px
- スマートフォン: 767px以下

### カラースキーム

- **プライマリカラー**: 青系（#2196F3）
- **セカンダリカラー**: グレー系（#757575）
- **成功**: 緑（#4CAF50）
- **警告**: オレンジ（#FF9800）
- **エラー**: 赤（#F44336）
- **進行中**: 青（#2196F3）

### アクセシビリティ

- WCAG 2.1 レベルAA準拠
- キーボード操作対応
- スクリーンリーダー対応
- 適切なコントラスト比

### パフォーマンス

- API応答時間: 200ms以下（LAN環境）
- ページロード時間: 2秒以内
- データベースクエリ最適化（インデックス使用）

---

## 技術スタック（推奨）

### バックエンド
- **フレームワーク**: Flask 3.x
- **データベース**: SQLite（小規模）/ PostgreSQL（中規模以上）
- **ORM**: SQLAlchemy
- **API**: Flask-RESTful

### フロントエンド
- **テンプレートエンジン**: Jinja2
- **CSSフレームワーク**: Bootstrap 5.x
- **JavaScriptライブラリ**: jQuery / Alpine.js
- **グラフ描画**: Chart.js

### セキュリティ
- **認証**: Flask-Login
- **CSRF対策**: Flask-WTF
- **パスワードハッシュ**: bcrypt

### デプロイ
- **Webサーバ**: Nginx / Apache
- **WSGIサーバ**: Gunicorn / uWSGI
- **プロセス管理**: systemd

---

## まとめ

本仕様書では、DRBL管理GUI全9画面の詳細仕様を定義しました。各画面はUI/UXを重視した設計となっており、直感的な操作で年間100台規模のPCキッティングを効率的に管理できます。

### 実装優先順位

1. **フェーズ1**: 基本機能
   - ダッシュボード
   - PC一覧・追加・編集
   - セットアップログ表示

2. **フェーズ2**: 一括処理
   - CSV一括登録
   - ODJファイル管理

3. **フェーズ3**: 詳細機能
   - ログ詳細画面
   - 設定画面

4. **フェーズ4**: 拡張機能
   - リアルタイム更新
   - メール通知
   - バックアップ機能

各画面の実装にあたっては、本仕様書のレイアウト図、バリデーションルール、エラーメッセージを参照してください。
