# 🏗 完全版：会社キッティング自動化フレームワーク

以下は、**マスターPC作成 → Sysprep → Clonezilla イメージ化 → 展開 → 自動PC名設定（導入年月日＋M） → ODJ → ドメイン参加 → Windows Update → 完了** までを一気通貫で実現するための全体フレームワークです。

---

# ① マスターPC構築レイヤー（基準イメージ作成）

## **1. 会社仕様マスターPC作成**
- Windows11 最新版をインストール
- 標準アプリ・ドライバ・ポリシー反映
- セキュリティ設定・更新設定・最適化

## **2. Sysprep 実行**
```
sysprep /generalize /oobe /shutdown /unattend:unattend.xml
```
※ shutdown が重要（Clonezilla イメージ作成のため）

## **3. Clonezilla でマスターイメージ取り込み**
- Clonezilla Live で起動
- DRBL サーバの /home/partimag に保存
- 圧縮：zstd or gzip

---

# ② 前処理レイヤー（箱のまま台帳生成）

## **1. PC納品（梱包状態のまま）**

## **2. 箱側面の Serial をスマホで撮影**
→ ChatGPT で OCR 抽出（高速・正確）

## **3. PC名を会社命名規則で自動生成**
- 命名規則：**導入年月日＋M**
- 例：2025/11/16 → `20251116M`

## **4. PC名＋Serial の CSV を作成**
例：
| PC名 | Serial |
|------|--------|
| 20251116M | ABC123456 |
| 20251117M | DEF987654 |

---

# ③ インフラレイヤー（DRBL / Clonezilla 管理）

## **1. DRBL + Clonezilla Server Edition の構築**
- PXE サーバ設定
- イメージ格納
- マルチキャスト対応

## **2. 管理DB（GUI）構築**
保存内容：
- PC名（20251116M）
- Serial 番号
- ODJ ファイルパス

## **3. CSV をインポートして管理DBに登録**

## **4. ODJ ファイルを PC名ごとに作成**
- 例：`20251116M.txt`
- OUもここで指定

## **5. DRBL API 提供**
```
GET /api/pcinfo?serial=ABC123456
→ { pcname: "20251116M", odj: "/odj/20251116M.txt" }
```

---

# ④ 実行レイヤー（PXE → 自動設定 → 完了）

## **1. PCをLANへ接続 → 電源ON**
- PXE起動（F12 or 自動）

## **2. Clonezillaでマスターイメージ展開**
- 10〜20台同時展開も可能

## **3. Windows 初回起動 → 自動ログオン**

## **4. PowerShell 初期セットアップ開始**

### 🔷 PCが“自分自身を名乗る”フェーズ

#### Step1：Serial を自動取得
```
$serial = (Get-CimInstance Win32_BIOS).SerialNumber
```

#### Step2：DRBL API へ問い合わせ
- Serial → PC名を取得

#### Step3：PC名を自動設定
```
Rename-Computer -NewName "20251116M" -Force
```

#### Step4：ODJ ファイル適用
```
djoin /requestODJ /loadfile C:\ODJ\20251116M.txt /localos
```

#### Step5：再起動（1回）
→ **ドメイン参加済み状態で起動**

---

## **5. 自動後処理**
- Windows Update
- 会社アプリ自動導入
- OneDrive KFM
- セキュリティ確認
- 完了ログ送信

---

# ⭐ 最終結果
- PC名：会社命名規則（例：`20251116M`）で自動設定
- ドメイン参加（OU込み）完了
- Windows Update 完了
- 標準アプリセットアップ完了
- **管理者はLANに挿して電源を入れるだけで完了**

---

必要であれば：
- 全体アーキテクチャ図
- DRBL API 仕様書
- PowerShell 実スクリプト
- マスターPC構築チェックリスト
- 完全自動キッティング標準手順書

なども追加で作成できます。

