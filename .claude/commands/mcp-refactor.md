---
description: MCP統合でインテリジェントなリファクタリングを実行
---

**Serena + Context7 + Sequential Thinking**を統合して、安全で効果的なリファクタリングを実行します。

## 実行内容

### 使用するMCPサーバ

1. **Serena** → コード構造解析・シンボル操作
2. **Context7** → 最新ベストプラクティス
3. **Sequential Thinking** → リファクタリング戦略
4. **Memory** → リファクタリング履歴記録

## リファクタリング対象

### 1. コード重複（DRY違反）
- 同じロジックの複数箇所実装
- 共通化可能な処理の抽出
- ユーティリティ関数化

### 2. 長大な関数・メソッド
- 責務の分離
- サブ関数への分割
- 読みやすさ向上

### 3. 複雑な条件分岐
- Early Return パターン適用
- ガード節の導入
- ネストレベル削減

### 4. 命名の改善
- より明確な変数名
- 統一的な命名規則
- ドメイン用語の適切な使用

### 5. アーキテクチャパターン
- MVC/MVP パターン適用
- 依存性注入
- インターフェース分離

## リファクタリングプロセス

### フェーズ1: 分析
1. **Serena**: コード全体をスキャン
2. **Sequential Thinking**: リファクタリング対象の優先順位付け
3. **Context7**: 最新のベストプラクティス確認

### フェーズ2: 計画
4. **Sequential Thinking**: リファクタリング戦略立案
5. **Serena**: 影響範囲の特定（参照元検索）

### フェーズ3: 実行
6. **Serena**: シンボル名変更、コード置換
7. **Context7**: 推奨パターンに基づいて書き換え

### フェーズ4: 検証
8. テスト実行で動作確認
9. **Memory**: リファクタリング内容を記録

## 安全性保証

### 1. 参照元確認
Serenaで全参照元を検索し、変更の影響範囲を事前確認

### 2. 段階的実行
一度に大規模変更せず、小さなステップで実行

### 3. テスト実行
各リファクタリング後、テストで動作確認

### 4. バックアップ
Git コミット前に変更内容を確認

## 使用例

### コード重複解消
```
/mcp-refactor
プロジェクト全体でコード重複を検出し、共通化してください
```

### 長大関数の分割
```
/mcp-refactor
100行を超える関数をすべて検出し、適切に分割してください
```

### 命名改善
```
/mcp-refactor
a, b, x, temp などの不明確な変数名をすべて検出し、わかりやすい名前に変更してください
```

### APIエンドポイント整理
```
/mcp-refactor
flask-app/views/ 内のAPIエンドポイント関数を、RESTful設計原則に基づいてリファクタリングしてください
```

### PowerShellスクリプト改善
```
/mcp-refactor
powershell-scripts/ 内のすべてのスクリプトを、PowerShellベストプラクティスに基づいてリファクタリングしてください
```

MCP統合で安全かつ効果的なリファクタリングを実現します。
